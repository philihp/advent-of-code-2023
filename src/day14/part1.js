import { reverse, sortBy, identity, join, split, tap, transpose, reduce, pipe, map, addIndex } from 'ramda'

const testinput = [
  'O....#....',
  'O.OO#....#',
  '.....##...',
  'OO.#O....O',
  '.O.....O#.',
  'O.#..O.#.#',
  '..O..#O..O',
  '.......O..',
  '#....###..',
  '#OO..#....',
]

const realinput = [
  '.O....O.OOO..O.#.#.###.#O....OO..OO.O...O...O###..#.#....#.#....##..O.O.O##.......O.#.O.......##O#O.',
  '..#.#.#......O........O#OOOO#.O.#.#.#..O.#O...#..O...#..O.O#......#O...##O...O.#...O.O...##O.O.O...#',
  '.......O.OO..O.##.#..O.#...O#.#.......O.O.##.......#.O..#.......O.....#...O...#.#OO......#....#.....',
  '....#.....O#.O..O..#..#OO.#OO....#.......O..O.O...#.....#.O.....O..O.O....#..#O..O.#.O....O.......#O',
  '.........O.O....O.#O..#..........#O#......###.#..OO...#.O#O.O.O#....##...O.O..#.O..OO.#.OO...O#.OOO.',
  '.#O..#.O....#O...O#.........O#O..#O..#O.O.OO..O..#...#O...O..OOOO.....O..O.........O..#O##......O##.',
  '..O#.O.....#.O..O.#.O......O#O.#..#.O.O..#..O.O#..O..#O.....##.#....#..OO.#.........OO....#...O....O',
  '.O.O#..O.###....O#....O...#....O.O....O.O.O......O.O###OO.#.O...O..O..O.....O.#.O#..OO..O#.OO#OO.#OO',
  'OO...#O#......#####OOO.O###...........O#....#.#.O.O.##...O#.O...........OO.#...#......O.O....#..O..#',
  '.O..OO....#.#.##O.O#..OO....#...O..O...O.O###.##O.......#O.....##.O..O##.....O...OO.#....#.#.O.....#',
  'OOO#O.....O.O....O.O#....O.OOO........#..#.O..#...O...OO#.O...OO#..O..O.#..##.......#......O....O.O.',
  '......O..OOO..OOO..##OO...O...#.#.#..O..#..#OOO...O.O.O#......O#.....#..O#O...#.OO.....#.O.#.OOO..#.',
  'O...........OOOO.OO#O....#........O...#.##......#.OO..O.OO.#.O.....OO#.#..#.OOO.#.#..#..O.....OO..#.',
  '....O..O.O.#....OO.#.#O..#....#..O#..........O..O.O#......#....###.O.#..#.#......O......O....#.#O..O',
  '....#O....#..OO..O#O.#.OO##O..O##..O..O.......##......OO..OOO#..O..OO....O.#..O##..#......#.O.....OO',
  '.O.#.O..##O#...##....##.#.O..#O#O.......#...O..........O.O.......O.....O..#.....#....#.O.#.#...O...O',
  '....###....#.....#O.#O###O#.O....#O#O.##.OO#.O#O..#..O..#..#.O##.............O....#O...#.....O...O##',
  '.O...##....O..#..#..O#.......O....O...O.O..#O...#.......#.......O.O..O#.O##..O.O......#...#......O..',
  '......O##..OOOO#.........O......O.#O.....#OO..#.O..OO......#.O...##.##...O#.........#.....#.........',
  '.#.....OO....OO..O.#OO#..#.#.##.O....O..OO.O.........O..O.O....##...#.O#.O..#........O#.O##.#...#.OO',
  '.O.#....O.O#......OO..#OOO.O........##.O.....#O......#.....OO..O#..O...O..O#O...........#.#O...#O...',
  '....O#O...#...#..#.##O...OO.#.#.O..#....O....#.O....##.........O.O.#...#...#....O...#...##.#..#...O.',
  '..#O##...O.OO.#.#....O...#...#....O...O....#.#.O.O.OO..O.OO.......#.O#....O##.O#.O..O##O........OO#.',
  '.#...##.#.O...O..........O.O##..##.O###..##...O..#.O.....O##O...O.....O.......O..#..#.O#.#....#O#...',
  'O..#O#.O......#..##.O...O.##O.#...O....O.O.#....O........OO..#.O...O....###.O.O#.#O...O.#O.....#.O..',
  '#.O...O.O......O.O.O....O..#O...O..OO.OOO...#.O.OO....#......#.#.O.O#..O..O...#O#.......O.OO.##..O..',
  '..OO..#O#.O#..##....#..OOO...#O..O.O.#.#.OOO#.#...#.OO#O......#.#..#......OO..O..#..#..##..O#....O#.',
  '.OO#...O#O.#.#..O..#......O...O......O#.#.##O...#.#..#..#.###..O.###.#....O...O..#...#O......O....O.',
  'O....#O..##...O...O..O#O#.....#O.....#..#.#....#...##..#.....#.#......###O....#OO#.##O..O.O....O....',
  '....O.###.....O...O.O...O...O#OO..#.#.....O.OO.....#O...##O#OOO.#..O...OO#O.O....O....O..#..O....#..',
  '...O..#O..O...O......##OO..O..O.....O....O..O##O.#OO..#O..O.#......#.O..#O.......O....O#...O.O.....O',
  '...O#O..#..O.O......O.....#..................#O..##.#....O..O....O#...##.O...#.O.#........#O#..#..OO',
  'O....O.#.......#O#....O...O.#O...OO.O..OOO..#...#.OOOO.O..#..#....O.........#.#..O..#..#.#.O..OO.O..',
  '#O..O......O...O#......O#..#...O.#O.#.O...#.#.#.O....#O.#..O#...OO...#O#..O...#O.#.##O.O..O#O#.#O.O#',
  '#.##...O..O.O...##...O..#OO...OO........O....OO..OO.......O##.OO..#..#............#.O.......#.O.OO#.',
  'O#..#.OO..##....#O..OO..#...#..#..###.#O...O#..#.....O.O.#OO.........O..O...#....#.#O....#.O.....O..',
  '..OO.O......O.OO.OO.....O..#OO...##.O.O.O.#.#O#..#...O...O...#...O...O...#.........#....#.#.O#......',
  'O..#.....##O.#O....OOO.........O..#...#......##.#O.......O.OO....OO..OO..#.#...O#O..##........#O..O.',
  '##.O...#..#.O##.O......O...#....#.O..#...OO....O.OOO...#O#.#OO....##.#O......##......O..OO.......#..',
  '....O........#.O#...........O..#..#OO.OOO#.OO##...#.OO............##O...O.O.O#.....#..#.O.#.#.O...O.',
  'O.#....O....#...O#O..#O.O..#..#O...#.O..O.O.....OO....OO##....O.O#.......#...O.....#OO.#....O.OOO...',
  'O...#..#...#..OO...##.....#OO#O....#.#.OO.......O..O..O..#..#......O..OO...O.OO.O..OO#..###O#O.....#',
  '........OO#.O..#.....###....O........O....O.O..O#.OOO....#OO##.O#OO.......#.O......O.O......O...O.O.',
  '...#.#...#O..#...O.#.OO.O........O#....#O..O..O.O#.O...#..#.OO.OOOO.#...#...O...#O..#..OOO..O...O#.O',
  'O.OO#O#.#.#O..O#OOO..O..#.##..#.##OO#.#..#O.O#O.O...OO...O..O.......O.......##........#.##.......#..',
  'OO.O.##.#.#...#...OO##.....#.O...#....O#.#.O..O..#...#....#O...OO....#.O...##O....#O.O..O#O...OO#.#O',
  '.#...#....#....O#.O..#...OO##...O.#.#......#.O###.O.#OO....#......OO.......O#..#O#.OO..O.O......#O#.',
  '..O#..O..O....#.#..#OOO....##O..#...O...##..##..##.O.O#...O......#........OOOO..O#.....O.#.#O.....#.',
  '.#..#.O.........#..........OO.#...#.#..O...##OOO.......O..O###..#...#.......#.OO#..O..#....#OO......',
  '.O..#.##.O..#..O....#.O......O#.......#..O.OO..O...#....##..O.#O.#..#.##O#.O..OO#O.#..O...#.#.O.O#.O',
  '##....OO..##.OO....OO#.O#.O.#..#...O..#.#.O...O.O......O#...#.##.O........OO.....#O...##.#..OO.....O',
  '..#.OOO......O.....O.#..O..O##..O..#.#...OO..#..O....O..#.#O........#.#.O...#.O....#...O...O......O.',
  '..O#..#.#.#.O...O#..O.O..O.O#O...O..O..#O...#..O.O....#....O#...#O..##.#O..O.##O.O.#..O.O.....OO...O',
  '..#.....OO....O.O..#....OO..O...#.#..OO..#O..#...O..O..#.##.OO.O.O.O.O.....#..#...#O.##..O...O.#.#..',
  '....O...O....OO.......O.O.....O....OO...###..O##.......#...#O.#.O....O..#.O...#.OO#..O#.#..#...##...',
  '...#O....OOO.OO..#.#.O.O.O.#..O..O#...O.#O..........#..#OO...#.O..#O...OOO..#...#....#...O.OO#O....O',
  'O...O....O.O...#...##O...O....OO#O.O##.##..O..#...OO.......#....OOO.O.#.#....O...OOOO.#.....#....#O.',
  '.....OOO....O..O.#..O#O#......OO...........#......O.OO.OO.#..O..#.O#.OOOOO.O..##OO...O..#.O..O.O.O.O',
  '#..#.O..OO....#.###O...O....#O#O#OO...O.O#.....OO.O..O.O......O.OOO#.........O.#..O..O.O.O#.O.O..OO.',
  '#O.O..#....#O.#..O#OO....O........#.....O...##...OOOO.O............O.....OO.O....##O..##.#......O...',
  'O#.#..#.O.....#O....#.#..O.O.......O..O...#OO....#...OO.#....O.O.O.....O...#O.#O.O.O#....O#.........',
  '..O.O......O..#.O..O..O#OO........O..#.O.#.....O#O#O#.#O#..##O....OO.#..O.O#..OO.....OO.OO......##O#',
  '.OOOO.##.#.#......O..O...O##O##.O.OOO#.O.O.OO....O.......O.#....O..##......#...O..#..##O#OO..##...O.',
  '......#O.##....#...O.#.#.O##..O.#.......##.OO#O#.##..O.....#.#.#O.....#O.O#O......O....#.#....O#.OOO',
  '..#......#..O#.......O#.#OOO...#...O#............O.O.#.#O..##...#O#O....#.....##O#.O.OO...O...O#.OO.',
  '.#.O.#.#.OOO..#.#.O#...#..#...O...O...O#.OO...OO.O#..O.#...OO#.#..O....#.O#.O#..O#.##.O.O..O.O#.O.O.',
  'O.O#.OO#O.OO#O.....O.O.O.O...#OO....#.#...O.O.OO.O#.#.O.OO..#.O.O...#.....#....OOO....#.O.O.OO#...O.',
  'O#O......O......O..#......O.....#O#O..O......#...O....O#O##.....O#....#...#.#.....OO#.O.O.O#OO..#.#O',
  'O#.....#.O#O.#.....O.OOOO........#.#O......OO.O.O.....O....#O.##.O.....OO....O#..O......O......#..OO',
  '..#..#..OO..#.#...#O...###...O...#.#....O...O.#..O...O.O.#......#......#O.O...#OO.#O...#.O....O...O#',
  'OOO.O.OO..#.O.#O.OO.........#..........#.O#......O..#O.#..#O......#..#.O#.......O..............O..O.',
  '.OO.O.....OO...O.O..##....O.......OO..#O##..O..#.#.O#.#.O.....#..#.O.......O.##.O..#.OO.OO..........',
  '.........##O.#.#......#...O...##OO.OO....OO...#.OOO#.....O..#...#O.O..##.O#.O...........O#.O#.#O.O..',
  '..O#..#O#..........OO.O......#...O.....O.O#..O#.#..........OO...#.#...O##....OO.#O.....##O...O.#....',
  '.###.O.#O.#....O.#.#O#..O..........O..#.##O.#...O.O#..#..#O.O.##...#O....O.#..O.O..#.O..#O#.#......O',
  'OO.......#.O...##..#.#..#OO...O...............OO#.....#.O...#.........#..O...O....O.....##..O.......',
  '.#..O..##.OO..O#...O.....OOO.#..O#.OO...##.O.OO.O...OO.O.O#O.....O#...........#..OOO.OO##.O#..#OO.O.',
  '.O.....O..#...O..O......O.O...O.....O........O...#.#O...O#O.O...###.O..O.O...#O...O.O.OO.O.O...O#OO.',
  '.............#...#O..O#O.O.O....O................#....O....#O.O..........OO#.##..#.O##.........#....',
  '#O##O#OOO.#..O..O....O..O.##..OOO..O.O...............O..O.O#O.###......O...O......OOO.##.#...OO..O.#',
  'O...OO#O.O#.OO..OO........#.O....O...#........O...#..O...##O...O#...........#.O.#...O#...O#..#OO..O.',
  '.##O.#...O...O....#O#...#O.O#.O##...#....O#..#..#OO....#......#..O#..O.O..O...O..........O...#..O...',
  '.....O...#...........O..O..##.....O.OO.....#O..OO..#..O.....#......O...##O##.#.#...O.OO.OO##.#.#..#.',
  '#..O...#.##O#.#OO..##O....O...#.O.#O#..O...OO..O....O#O#.#....O...........O......##O.....#...#...##O',
  'O..........OO..O.#..O.#...O.#.#.#......#.O..O#......O....O.O.O.O.##.O#..##....O#O#....O........#.O.O',
  'OO...##.....O..O.#O...O..OO.#.O.O.#.O.........O...O.O.O.O.#.#O...O..#.O.....#....#..#...O#..#..O...#',
  'O##...#OO#.##.OO.O..#..OO.......OO.OO#.OO..O.......O.......OOO.#...#O#O.#..O......O..O.....#...##.#.',
  '#..O..#.OO.#.O.O.O.#.O##...#.O.O....###......O#OO.......OO..OO....#...O...#.........OO....O.......O.',
  '...#.#.##.....#...........O.OO.....O.OO..O.O..#..#....#..#O..O#....O#OO##.#.....O.....#.......O#O.O.',
  '.#..O.#...##...O.O.#...O.....#O.#O..#.OOO...........##.....#.#O#.##....OO#.O.....O.....OO.O.O.OO....',
  '#O#..OO..O#..O..O...OO.OO.#.....OO.......#.....O.O.O#..OOO......O.#..#O...O..O..O.#....O.O..OO#OO#..',
  'O.###O.O...O.....O..#.O..O...O..OO##.O..##..O..O...##O.#....#.O.O....O.O.........#OO#O....O.....O..O',
  '........#.O...O...#.#.#OO.O.#.O.....O#...O....O..#....#..O..#..........OO..#.O....OO.O..O...OOO...O#',
  '.#.#...........O.O.......#.#O..O....#O..O...O.O..O..#.#.....O.....O.#...OO.O....#O..O.O#.O.....#....',
  '.O.#...##.#.OO..#O...#....#.#.......#...#O....#.....O...O#.#.OO.#.O#.....OO....#.OO..#..O.O.OO....O.',
  '.OO#OO#.##.##OO..O.....O..O#OO.O.#....#....#.OO##..#..#.........#..............OO...O.....O.......#.',
  '..O.....#..#.......O..#O...#...#.O.........###.#...O.O.#....O................O.#O#O#..O..#.#...#..#O',
  '..#O...O.......OO#.#..#O.....OO.OO..O..##....#.O#...#.O..O.OO.....#..O...OO.O.O....#O..O.#..#......O',
  '.O.......O.....O..O...#.....O..O##..#......O.#...O#O.#.O.O.O.OO.O.#......OO.OOO.O#.OOO#O...#..#.O...',
  '...O.O#.OOO##.O#O...O##.O....O..O.##.#OO..O#.O.O...OOO#..O...##......#O........O..O.O....O........OO',
]

const input = realinput

console.log(
  pipe(
    transpose,
    map(
      // for each array of chars...
      (chars) =>
        pipe(
          //
          join(''),
          split('#'),
          map((s) => join('', reverse(sortBy(identity, s)))),
          join('#')
        )(chars)
    ),
    transpose,
    map(join('')),
    addIndex(map)((s, i) => [s, s.split('O').length - 1, input.length - i]),
    map(([s, a, b]) => [s, a, b, a * b]),
    reduce(
      ([list, total], [s, count, weight, load]) => {
        return [[...list, s, load, total + load], total + load]
      },
      [[], 0]
    )
  )(input)
)
